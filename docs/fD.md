## D. 横断UX（ホーム・ウィジェット・ナビゲーション・情報設計）仕様書【v1.0 確定】

本章は、機能 A（在庫・買い物・出費）、B（予定・通知）、C（メッセージ）を  
**「迷わず・漏れず・疲れずに使える体験」へ統合する横断UX（機能D）** の確定仕様を定義する。

---

## D-0. 基本方針（確定）

- ホームは **“今、家族内で把握すべき未消化情報”を最優先**で表示する
- 通知が多い前提のため、**ホームは通知の回復地点（インボックス）**として機能する
- 出費の数値可視化は v1.0 では抑制し、行動誘導を優先する
- 各ドメインの「警告・要対応状態」をホームで一元吸収する

---

## D-1. ホーム画面の優先順位（Q1反映・確定）

ホーム上の情報ブロックは、以下の **固定優先順位**で上から配置する。

### 優先順位ルール

1. **C：未読・未消化メッセージ（存在する場合のみ最上段）**
2. **A：要対応（在庫・出費の警告）**
3. **B：時間軸（予定・busy・リマインド）**

※ C の未読が **0件の場合のみ**、A が最上段になる  
※ B は常に最下段（ただし表示は行う）

---

## D-2. ホーム画面構成（4ブロック構成・確定）

### D-Home-1. メッセージ・インボックス（C）【最優先】

**表示条件**

- 未読メッセージ／未確認リアクション／未確認返信が1件以上ある場合に表示

**表示内容**

- 最新の未読メッセージ（複数可、上限UI側で制御）
- スレッド返信・リアクションも含めてカウント
- 各項目から **直接メッセージタイムライン／該当スレッドへ遷移**

**目的**

- 通知を見逃しても、ホームで必ず回復できる状態を作る

---

### D-Home-2. 要対応（A：在庫・出費）

**対象**

- 期限が近い在庫（expiryDate）
- lowFlag が ON の在庫
- 出費の警告状態
  - Receipt合計 ≠ LineItem合計
  - OCR抽出未確定（手修正が必要）

**表示内容**

- 対象名＋状態ラベル（例：「牛乳：期限間近」）
- タップで **該当詳細画面へ直接遷移**

**目的**

- 生活オペレーション上の“見逃すと困ること”を確実に拾う

---

### D-Home-3. 今日の時間軸（B：予定・busy・リマインド）

**構成**

- 家族イベント（Family Event）
- Google busy（busy時間帯のみ）
- リマインド

**表示ルール**

- 時間順に **同列（横並び）表示**
- 「今日〜直近」を中心に表示（UI側で範囲制御）

**目的**

- 今日・直近で「時間的に影響すること」を一望する

---

### D-Home-4. クイックアクション（ショートカット）

**固定表示**

- レシート追加（OCR）
- 在庫追加
- 買い物タスク追加
- リマインド作成
- メッセージ投稿

**目的**

- 思いついた瞬間に最短で操作できる入口

---

## D-3. ウィジェット仕様（確定）

### D-Widget-1：次のGoogle busy

**内容**

- 次に訪れる busy 時間帯（開始–終了）
- 対象メンバーの詳細は出さない（busyのみ）

**状態**

- busyなしの場合：「次の予定なし」

---

### D-Widget-2：次の予定／リマインド

**内容**

- 次の家族イベント
- 次のリマインド（未完了）

---

## D-4. ナビゲーション構成（v1.0確定）

### 推奨タブ構成

1. **ホーム（D）**
2. **在庫（A-2）**
3. **買い物（A-3）**
4. **出費（A-4）**
5. **メッセージ（C）**
6. **予定（B：イベント/カレンダー）** ※任意だが推奨

**設計意図**

- ホームを必ずハブにする
- メッセージは独立タブとして即アクセス可能にする

---

## D-5. 通知インボックス設計（Q3反映・確定）

### 方針

- ホームは **通知インボックスとしても機能**する
- OS通知を見逃しても、ホームに未消化情報が残る

### 対象

- C：未読メッセージ／返信／リアクション
- B：未消化リマインド（完了していないもの）
- A：未対応警告（在庫期限・出費差分など）

---

## D-6. 横断的「警告」の統一扱い

### 対象警告

- 競合警告（後勝ち・後操作ユーザーへの警告）
- 出費差分警告
- OCR未確定警告

### 表示方針

- 個別画面では最小限表示
- ホームの「要対応」ブロックに集約
- 警告は **通知ではなくUIで吸収**する（ノイズ防止）

---

## D-7. v1.0で意図的に行わないこと

- ホーム上での出費「当月合計」表示（Q2=No）
- 高度な通知フィルタリング／サマリー
- カスタムホーム編集
- ウィジェットの多数展開

---

## D-8. 将来拡張候補（v1.1+）

- ホームブロックの並び替え／ON-OFF
- 出費サマリー（月次・カテゴリ）
- 通知インボックスのフィルタリング
- ウィジェット追加（在庫期限・lowFlag専用など）

---

## D-9. 仕様確定メモ

- ホーム最上段は **C（未読がある場合）**
- 出費は v1.0 では「警告のみ表示」
- 通知は抑制せず、UX側で吸収する設計
